assume cs:codesg, ds:datasg, ss:stacksg

;

codesg segment
start:	
	;init registor
	mov ax,datasg
	mov ds,ax	;ds:datasg
	mov ax,stacksg
	mov ss,ax	;ss:stacksg
	mov sp,100h	;sp:
	
	;画地图
	call print_map_fun_
	
	
		
	mov ax,4c00h
	int 21h
	

print_map_fun_:
	;画地图
	push ax
	push bx
	push cx
	push es
	
	mov ax,0b800h
	mov es,ax
	mov bx,0
	mov cx,80*25
	print_map_fun_loop:
		mov ax,screen[bx]
		mov es:[bx], ax
		add bx,2
	loop print_map_fun_loop
	
	pop es
	pop cx
	pop bx
	pop ax
	ret
	
display_number_str:
	;input 	dx ax
	;output 转换成字符，并显示
	;mov dx,0 增加dx32位支持而去掉此行
	
	;Usage:
	;mov dx,0
	;mov ax,1234
	;call display_number_str;1234
	
	push es
	push bx
	push di
	push cx
	
	mov bx,0 		;计数
	
	dx_ax_not_eq_0:
	mov cx,10
	call div_dw
	push cx
	inc bx			;计数+1
	cmp dx,0
	jne dx_ax_not_eq_0
	cmp ax,0
	jne dx_ax_not_eq_0
	
	mov ax,0b800h
	mov es,ax
	mov di,0 ;用于屏幕字符后移,开始行
	mov cx,bx  ;取出循环次数，之后可以随意使用
	mov bx,0a0h*8
	print:
	pop ax
	mov ah,2
	add ax,'0'
	mov es:[bx+di],ax
	add di,2
	loop print
	
	;receive
	pop cx
	pop di
	pop bx
	pop es
	ret
div_dw:

	;(dx*10000h+ax)/cx
	;input:	被除数Hdx Lax，除数:cx
	;output:商:Hdx Lax，余数:cx
	
	;init
	push bp
	mov bp,sp

	;ax = dx,store src ax
	push ax;store src ax
	push dx
	pop ax
	
	;heigh div
	mov dx,0
	div cx
	push ax;src heigh bit
	
	;low div
	mov ax,ss:[bp-2];receive src ax
	div cx
	mov cx,dx
	pop dx
	add sp,2
	
	;restore
	pop bp
	ret

_get_screen_mem:
	;argc:
	;	row		4	行 0-24
	;	col		6	列 0-79
	;return ax:内存中的数据
	
	;Usage:
	;	mov ax,col
	;	pop ax
	;	mov ax,row
	;	pop ax
	;	call _get_screen_mem
	push bp
	mov bp,sp
	push bx
	push di
	push es
	
	mov ax,0b800h
	mov es,ax
	
	mov ax,0a0h
	mul word ptr ss:[bp+4]	;row * 0b800h
	mov bx, ax
	
	mov ax,ss:[bp+6]
	add ax,ax				;col * 2
	mov di,ax
	mov ax,es:[bx+di]
	
	pop es
	pop di
	pop bx
	pop bp
	ret 4

_print_c_:
	;argc:
	;	row		4	行 0-24
	;	col		6	列 0-79
	;	char	8
	;	att		10	显示属性
	
	;Usage:
	;mov ax,2;att
	;push ax
	;mov ax,'c'
	;push ax
	;mov ax,79;col
	;push ax
	;mov ax,24;row
	;push ax
	;call _print_c_
	
	push bp
	mov bp,sp
	
	push es
	push di
	push ax
	push bx
	
	mov ax,0b800h
	mov es,ax
	mov ax,0a0h
	mul word ptr ss:[bp+4]	;row * 0b800h
	mov bx, ax
	
	mov ax,ss:[bp+6]
	add ax,ax				;ax * 2
	mov di,ax
	
	mov al,ss:[bp+8]
	mov ah,ss:[bp+10]
	mov es:[bx+di],ax
	
	pop bx
	pop ax
	pop di
	pop es
	
	pop bp
	ret 8

codesg ends

datasg segment
	screen dw 4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,2000h
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0
dw 0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0
dw 0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0
dw 4000h,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,4000h
dw 4000h,4000h,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0
dw 0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,4000h,4000h
dw 4000h,4000h,4000h,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0
dw 0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0
dw 0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0
dw 0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0
dw 0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0
dw 0,0,0,0,0,0,0,0,0,0,0,0,0,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h
dw 4000h,4000h,4000h,4000h,4000h,4000h,4000h,4000h,0,0,0,0,0,0,0,0,0,0,0,0

datasg ends

stacksg segment
	db 0ffh dup (0)
stacksg ends

end start